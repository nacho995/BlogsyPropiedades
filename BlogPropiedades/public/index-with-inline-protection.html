<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Propiedades - Con Protecci√≥n TDZ Inline</title>
  
  <!-- Protecci√≥n TDZ inline - DEBE ser el primer script -->
  <script>
    // Protecci√≥n TDZ en l√≠nea - Directamente incluido en el HTML
    (function() {
      // 1. Pre-inicializar variables cr√≠ticas
      try {
        // Usar var para asegurar que sea global y hoist
        var y = {};
        var wi = {};
        var Fp = {};
        var Nc = {};
        
        // Informar
        console.log("üîí Variables cr√≠ticas 'y', 'wi', 'Fp', 'Nc' protegidas en l√≠nea");
        
        // 2. Preparar reinyecci√≥n en caso de error
        window.addEventListener('error', function(event) {
          if (event.message && event.message.includes('Cannot access') && 
              event.message.includes('before initialization')) {
            
            // Extraer nombre de la variable
            var matches = event.message.match(/'([^']+)'/);
            if (matches && matches[1]) {
              var varName = matches[1];
              
              // Inyectar inmediatamente mediante script inline
              var script = document.createElement('script');
              script.textContent = 'var ' + varName + ' = {}; console.log("‚ö° Variable \'' + varName + '\' reinyectada");';
              document.head.appendChild(script);
              
              console.log("‚ö° Error TDZ interceptado para: " + varName);
              
              // Intentar prevenir propagaci√≥n
              event.preventDefault();
              event.stopPropagation();
              return true;
            }
          }
        }, true);
        
        // 3. Cargar el resto de los scripts de protecci√≥n
        var scripts = ['direct-y-fix.js', 'y-fix.js', 'navbar-fix.js', 'tdz-resolver.js'];
        
        function loadNextScript(index) {
          if (index >= scripts.length) {
            console.log("‚úÖ Todos los scripts de protecci√≥n TDZ cargados");
            return;
          }
          
          var script = document.createElement('script');
          script.src = scripts[index];
          script.onload = function() {
            loadNextScript(index + 1);
          };
          script.onerror = function() {
            console.warn("‚ö†Ô∏è Error al cargar: " + scripts[index]);
            loadNextScript(index + 1);
          };
          document.head.appendChild(script);
        }
        
        // Iniciar carga de scripts
        setTimeout(function() {
          loadNextScript(0);
        }, 0);
        
      } catch(e) {
        console.error("‚ùå Error en protecci√≥n TDZ en l√≠nea:", e);
      }
    })();
  </script>
</head>
<body>
  <div id="root"></div>
  
  <!-- Aqu√≠ ir√≠an los scripts normales de la aplicaci√≥n -->
  <script>
    // Script de ejemplo para mostrar que 'y' ya est√° protegido
    window.addEventListener('DOMContentLoaded', function() {
      // Verificar si 'y' est√° definido y protegido
      console.log('Estado actual de variables cr√≠ticas:');
      console.log('- y:', typeof y !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå');
      console.log('- wi:', typeof wi !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå');
      console.log('- Fp:', typeof Fp !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå');
      console.log('- Nc:', typeof Nc !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå');
      
      // Mostrar en la p√°gina
      const rootDiv = document.getElementById('root');
      rootDiv.innerHTML = `
        <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
          <h1>Blog Propiedades - Protecci√≥n TDZ Inline</h1>
          <div style="background-color: #f0f0f0; padding: 20px; border-radius: 5px;">
            <h2>Estado de la Protecci√≥n</h2>
            <ul>
              <li>Variable 'y': <strong>${typeof y !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå'}</strong></li>
              <li>Variable 'wi': <strong>${typeof wi !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå'}</strong></li>
              <li>Variable 'Fp': <strong>${typeof Fp !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå'}</strong></li>
              <li>Variable 'Nc': <strong>${typeof Nc !== 'undefined' ? 'Definida ‚úÖ' : 'No definida ‚ùå'}</strong></li>
            </ul>
            <p><em>Consulta la consola para m√°s detalles.</em></p>
          </div>
          <div style="margin-top: 20px;">
            <h2>Implementaci√≥n</h2>
            <p>Esta soluci√≥n implementa protecci√≥n TDZ directamente en el HTML, antes de cualquier otro script:</p>
            <ul>
              <li><strong>Protecci√≥n inline</strong>: Pre-define variables cr√≠ticas</li>
              <li><strong>Captura de errores</strong>: Intercepta y corrige errores TDZ</li>
              <li><strong>Scripts adicionales</strong>: Carga protecciones extendidas</li>
            </ul>
          </div>
          <div style="margin-top: 20px; background-color: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; white-space: pre-wrap; overflow-x: auto;">
            <code>&lt;script&gt;
  // Protecci√≥n TDZ en l√≠nea
  (function() {
    // Pre-inicializar variables cr√≠ticas
    var y = {};
    var wi = {};
    var Fp = {};
    var Nc = {};
    
    // Resto del c√≥digo de protecci√≥n...
  })();
&lt;/script&gt;</code>
          </div>
        </div>
      `;
    });
    
    // Probar que la protecci√≥n funciona
    setTimeout(function() {
      try {
        // Intentar usar 'y' que ya deber√≠a estar protegida
        console.log("Prueba de acceso a 'y':", y ? "Acceso exitoso ‚úÖ" : "Acceso fallido ‚ùå");
      } catch(e) {
        console.error("‚ùå Error al acceder a 'y':", e);
      }
    }, 1000);
  </script>
</body>
</html> 