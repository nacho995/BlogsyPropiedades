<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- Definir Nc lo m√°s temprano posible -->
    <script>
      window.Nc = {};
      window.__ncInitialized = true;
    </script>
    
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Goza Madrid - Portal inmobiliario y blog de propiedades" />
    <title>GozaMadrid - Inmobiliaria y Blog</title>
    
    <!-- Sistema de polyfill para variables minificadas -->
    <script>
      // Ejecutar antes de cualquier otro c√≥digo
      ['Qe', 'qe', 'Il', 'Kc', 'Hl', 'Oe', 'Si', 'Oi', 'Rc', 'Qc', 'Ab', 'Bb', 'Ni', 'Wc', 'Mi', 'Li', 'Ki', 'Ji']
        .forEach(function(name) { window[name] = {}; });
      
      // Interceptar errores de acceso a propiedades y crear las variables faltantes
      window.__originalGetFn = Object.prototype.__lookupGetter__; 
      Object.defineProperty(window, '__ncFixActive', { value: true, writable: false });
      
      console.log('‚úÖ Parche preventivo aplicado para variables minificadas');
    </script>
    
    <!-- Bootstrap debe cargarse antes que nada para configurar el entorno -->
    <script src="/bootstrap.js"></script>
    
    <!-- Fix espec√≠fico para el problema de Nc -->
    <script src="/ncfix.js"></script>
    
    <!-- Script de recuperaci√≥n de emergencia para errores de inicializaci√≥n -->
    <script>
      (function() {
        // Registrar el tiempo de carga inicial
        window.__loadStartTime = Date.now();
        
        // Sistema de recuperaci√≥n para errores de inicializaci√≥n
        window.addEventListener('error', function(e) {
          if (e && e.message && 
             (e.message.includes("Cannot access") || 
              e.message.includes("before initialization") ||
              e.message.includes("is not defined") ||
              e.message.includes("Nc"))) {
            
            console.error("üö® Detectado error cr√≠tico de inicializaci√≥n:", e.message);
            
            // Verificar si ya intentamos recargar antes
            var reloadCount = parseInt(localStorage.getItem('app_reload_count') || '0');
            var lastReload = localStorage.getItem('app_last_reload');
            var now = new Date().toISOString();
            
            // Si hemos recargado demasiado en poco tiempo, mostrar mensaje de error
            if (reloadCount > 3) {
              console.error("‚ùå Demasiados intentos de recarga, mostrando mensaje de error");
              // Mostrar mensaje de error al usuario
              var errorDiv = document.createElement('div');
              errorDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:9999;';
              errorDiv.innerHTML = '<h2 style="color:red;margin-bottom:10px;">Error de Inicializaci√≥n</h2><p>Por favor, recarga la p√°gina manualmente.</p>';
              document.body.appendChild(errorDiv);
              return;
            }
            
            // Incrementar contador de recargas
            localStorage.setItem('app_reload_count', (reloadCount + 1).toString());
            localStorage.setItem('app_last_reload', now);
            
            // Recargar la p√°gina
            window.location.reload();
          }
        });
      })();
    </script>
    
    <!-- CR√çTICO: Protecci√≥n TDZ Inline - DEBE ser el primer script -->
    <script>
      // Protecci√≥n TDZ en l√≠nea - Pre-define variables cr√≠ticas
      (function() {
        try {
          // Pre-inicializar variables cr√≠ticas (usar var para hoisting global)
          var y = {};
          var wi = {};
          var Fp = {};
          var Nc = {};
          
          console.log("üîí Variables cr√≠ticas 'y', 'wi', 'Fp', 'Nc' protegidas en l√≠nea");
          
          // Interceptor de errores TDZ
          window.addEventListener('error', function(event) {
            if (event.message && event.message.includes('Cannot access') && 
                event.message.includes('before initialization')) {
              
              // Extraer nombre de la variable con problema
              var matches = event.message.match(/'([^']+)'/);
              if (matches && matches[1]) {
                var varName = matches[1];
                
                // Inyectar variable inmediatamente
                var script = document.createElement('script');
                script.textContent = 'var ' + varName + ' = {}; console.log("‚ö° Variable \'' + varName + '\' reinyectada");';
                document.head.appendChild(script);
                
                // Intentar prevenir propagaci√≥n
                event.preventDefault();
                event.stopPropagation();
                return true;
              }
            }
          }, true);
          
          // Cargar scripts adicionales de protecci√≥n
          setTimeout(function() {
            var script = document.createElement('script');
            script.src = 'direct-y-fix.js';
            document.head.appendChild(script);
          }, 0);
        } catch(e) {
          console.error("‚ùå Error en protecci√≥n TDZ:", e);
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html> 