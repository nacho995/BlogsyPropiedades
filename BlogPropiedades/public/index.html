<!DOCTYPE html>
<html lang="es">
<head>
  <!-- SOLUCI√ìN TDZ OPTIMIZADA - DEBE SER EL PRIMER SCRIPT -->
  <script>
  (function() {
    console.log("üöÄ TDZ-FIX-FINAL: Iniciando protecci√≥n TDZ...");
    
    // 1. Pre-definir variables cr√≠ticas
    var y = window.y = {};
    var wi = window.wi = {};
    var Fp = window.Fp = {};
    var Nc = window.Nc = {};
    
    // Otras variables minificadas frecuentes
    ['Qe', 'qe', 'Il', 'Kc', 'Hl', 'Oe', 'Si', 'Oi', 'Rc', 'Qc', 'Ab', 'Bb', 'Ni', 'Wc', 'Mi', 'Li', 'Ki', 'Ji']
      .forEach(function(name) { window[name] = window[name] || {}; });
    
    // 2. Interceptar definiciones de componentes
    try {
      var jiOriginal = null;
      var NiOriginal = null;
      
      // Patch para ji (useProfileImage.js)
      Object.defineProperty(window, 'ji', {
        get: function() { return jiOriginal; },
        set: function(value) {
          jiOriginal = function() {
            var y = {}; // Definir 'y' localmente
            try {
              return value.apply(this, arguments);
            } catch(e) {
              console.warn("‚ö†Ô∏è TDZ-FIX-FINAL: Error en ji:", e.message);
              return null;
            }
          };
          return true;
        },
        configurable: true
      });
      
      // Patch para Ni (NavBar.jsx)
      Object.defineProperty(window, 'Ni', {
        get: function() { return NiOriginal; },
        set: function(value) {
          NiOriginal = function() {
            var y = {}; // Definir 'y' localmente
            try {
              return value.apply(this, arguments);
            } catch(e) {
              console.warn("‚ö†Ô∏è TDZ-FIX-FINAL: Error en Ni:", e.message);
              return null;
            }
          };
          return true;
        },
        configurable: true
      });
      
      // 3. Inyecci√≥n directa como medida preventiva
      function injectComponentFixes() {
        var script = document.createElement('script');
        script.textContent = "(function() { var y = {}; var _ji = window.ji; var _Ni = window.Ni; window.ji = function() { var y = {}; try { return _ji ? _ji.apply(this, arguments) : null; } catch(e) { return null; } }; window.Ni = function() { var y = {}; try { return _Ni ? _Ni.apply(this, arguments) : null; } catch(e) { return null; } }; console.log('üíâ TDZ-FIX-FINAL: Componentes ji y Ni protegidos directamente'); })();";
        document.head.appendChild(script);
      }
      
      // 4. Detector de errores TDZ
      window.addEventListener('error', function(event) {
        if (event.message && event.message.includes("Cannot access 'y' before initialization")) {
          console.warn("‚ö° TDZ-FIX-FINAL: Corrigiendo error TDZ");
          injectComponentFixes();
          event.preventDefault();
          event.stopPropagation();
          return true;
        }
      }, true);
      
      // 5. Ejecutar inyecci√≥n directa
      setTimeout(injectComponentFixes, 0);
      
      console.log("‚úÖ TDZ-FIX-FINAL: Protecci√≥n TDZ completa aplicada");
    } catch(e) {
      console.warn("‚ö†Ô∏è Error en TDZ-FIX-FINAL:", e.message);
      
      // Soluci√≥n de emergencia
      var script = document.createElement('script');
      script.textContent = "var y = {}; var wi = {}; var Fp = {}; var Nc = {};";
      document.head.appendChild(script);
    }
  })();
  </script>
  
  <!-- Definir Nc lo m√°s temprano posible -->
  <script>
    window.Nc = {};
    window.__ncInitialized = true;
  </script>
  
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Goza Madrid - Portal inmobiliario y blog de propiedades" />
  <title>GozaMadrid Real Estate</title>
  <!-- v13.0.0 SUPER AGGRESSIVE DEPLOY - FORCED UPDATE -->
  
  <!-- Sistema de polyfill para variables minificadas -->
  <script>
    // Ejecutar antes de cualquier otro c√≥digo
    ['Qe', 'qe', 'Il', 'Kc', 'Hl', 'Oe', 'Si', 'Oi', 'Rc', 'Qc', 'Ab', 'Bb', 'Ni', 'Wc', 'Mi', 'Li', 'Ki', 'Ji']
      .forEach(function(name) { window[name] = {}; });
    
    // Interceptar errores de acceso a propiedades y crear las variables faltantes
    window.__originalGetFn = Object.prototype.__lookupGetter__; 
    Object.defineProperty(window, '__ncFixActive', { value: true, writable: false });
    
    console.log('‚úÖ Parche preventivo aplicado para variables minificadas');
  </script>
  
  <!-- Bootstrap debe cargarse antes que nada para configurar el entorno -->
  <script src="/bootstrap.js"></script>
  
  <!-- Fix espec√≠fico para el problema de Nc -->
  <script src="/ncfix.js"></script>
  
  <!-- Script de recuperaci√≥n de emergencia para errores de inicializaci√≥n -->
  <script>
    (function() {
      // Registrar el tiempo de carga inicial
      window.__loadStartTime = Date.now();
      
      // Sistema de recuperaci√≥n para errores de inicializaci√≥n
      window.addEventListener('error', function(e) {
        if (e && e.message && 
           (e.message.includes("Cannot access") || 
            e.message.includes("before initialization") ||
            e.message.includes("is not defined") ||
            e.message.includes("Nc"))) {
          
          console.error("üö® Detectado error cr√≠tico de inicializaci√≥n:", e.message);
          
          // Verificar si ya intentamos recargar antes
          var reloadCount = parseInt(localStorage.getItem('app_reload_count') || '0');
          var lastReload = localStorage.getItem('app_last_reload');
          var now = new Date().toISOString();
          
          // Si hemos recargado demasiado en poco tiempo, mostrar mensaje de error
          if (reloadCount > 3) {
            console.error("‚ùå Demasiados intentos de recarga, mostrando mensaje de error");
            // Mostrar mensaje de error al usuario
            var errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:9999;';
            errorDiv.innerHTML = '<h2 style="color:red;margin-bottom:10px;">Error de Inicializaci√≥n</h2><p>Por favor, recarga la p√°gina manualmente.</p>';
            document.body.appendChild(errorDiv);
            return;
          }
          
          // Incrementar contador de recargas
          localStorage.setItem('app_reload_count', (reloadCount + 1).toString());
          localStorage.setItem('app_last_reload', now);
          
          // Recargar la p√°gina
          window.location.reload();
        }
      });
    })();
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>
</html> 